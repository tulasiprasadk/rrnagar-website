import React from "react";
import { useLocation } from "react-router-dom";

/**
 * WhatsApp floating contact button for Vite (import.meta.env).
 *
 * Usage:
 * 1) Save this file to src/components/WhatsAppFloating.jsx
 * 2) Ensure your top-level app imports and renders it:
 *      import WhatsAppFloating from "./components/WhatsAppFloating";
 *      ...
 *      <WhatsAppFloating />
 *
 * Env vars (Vite):
 * - VITE_WHATSAPP_NUMBER (e.g. 919999999999)
 * - VITE_WHATSAPP_MESSAGE (optional)
 */

const DEFAULT_PHONE = import.meta.env.VITE_WHATSAPP_NUMBER || "919999999999";
const DEFAULT_MESSAGE = import.meta.env.VITE_WHATSAPP_MESSAGE || "Hi, I need help with RRnagar";

export default function WhatsAppFloating({
  phone = DEFAULT_PHONE,
  message = DEFAULT_MESSAGE,
  hideOn = ["/admin"] // hide on these exact paths
}) {
  const location = useLocation?.() || { pathname: typeof window !== "undefined" ? window.location.pathname : "/" };

  // Hide on configured routes (exact match)
  if (hideOn && Array.isArray(hideOn) && hideOn.includes(location.pathname)) {
    return null;
  }

  const encoded = encodeURIComponent(message);
  const href = `https://wa.me/${phone}?text=${encoded}`;

  return (
    <a
      href={href}
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Contact us on WhatsApp"
      title="Contact us on WhatsApp"
      style={{
        position: "fixed",
        right: 18,
        bottom: 18,
        zIndex: 9999,
        display: "flex",
        alignItems: "center",
        gap: 10,
        background: "#25D366",
        color: "#fff",
        padding: "10px 14px",
        borderRadius: 999,
        boxShadow: "0 6px 18px rgba(0,0,0,0.25)",
        textDecoration: "none",
        fontWeight: 700,
        fontSize: 14,
        lineHeight: 1,
      }}
    >
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path fill="#ffffff" d="M20.52 3.48A11.91 11.91 0 0 0 12 0C5.373 0 .04 5.373.04 12c0 2.115.552 4.18 1.6 6.02L0 24l6.18-1.62A11.94 11.94 0 0 0 12 24c6.627 0 12-5.373 12-12 0-3.2-1.25-6.19-3.48-8.52z"/>
        <path fill="#ffffff" d="M17.472 14.382c-.297-.148-1.756-.867-2.03-.967-.273-.1-.473-.148-.673.15-.198.297-.767.967-.94 1.165-.173.198-.347.223-.644.074-.297-.148-1.255-.463-2.39-1.477-.884-.788-1.48-1.761-1.653-2.058-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.52.15-.173.198-.297.298-.495.1-.198.05-.372-.025-.52-.074-.148-.673-1.62-.923-2.21-.242-.58-.487-.5-.673-.51l-.576-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.475 1.065 2.873 1.213 3.074c.148.198 2.095 3.2 5.077 4.487 0 0 .688.297 1.24.454.52.148.99.125 1.36.076.414-.056 1.756-.72 2.005-1.414.248-.694.248-1.288.173-1.414-.074-.125-.272-.198-.57-.347z"/>
      </svg>

      <span style={{ display: "inline-block", marginLeft: 2 }}>WhatsApp</span>
    </a>
  );
}